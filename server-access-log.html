

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Writing an access log &mdash; Armeria 0.98.7 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/logo.png"/>
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/overrides.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Configuring CORS" href="server-cors.html" />
    <link rel="prev" title="Embedding a servlet container" href="server-servlet.html" />
  <meta name="google-site-verification" content="BFDmnYNF7ZdSsS6IqtaeQDT4c1tUqYjX543ZpLMnPjc" />
  <script src="https://cdn.jsdelivr.net/npm/interactjs@1.4.0/dist/interact.min.js"></script>
  <script src="_static/center_page.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/default.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.1/cookieconsent.min.css">
   

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html">
          

          
            
            <img src="_static/armeria.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.98
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="setup.html">Setting up a project</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="server.html">Writing a server</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="server-basics.html">Server basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="server-decorator.html">Decorating a service</a></li>
<li class="toctree-l2"><a class="reference internal" href="server-grpc.html">Running a gRPC service</a></li>
<li class="toctree-l2"><a class="reference internal" href="server-thrift.html">Running a Thrift service</a></li>
<li class="toctree-l2"><a class="reference internal" href="server-docservice.html">Browsing and invoking services with <code class="docutils literal notranslate"><span class="pre">DocService</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="server-annotated-service.html">Annotated services</a></li>
<li class="toctree-l2"><a class="reference internal" href="server-http-file.html">Serving static files</a></li>
<li class="toctree-l2"><a class="reference internal" href="server-servlet.html">Embedding a servlet container</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Writing an access log</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#configuring-logging-framework">Configuring logging framework</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#logback">logback</a></li>
<li class="toctree-l4"><a class="reference internal" href="#log4j2">log4j2</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#customizing-a-log-format">Customizing a log format</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#retrieving-values-from-requestlog">Retrieving values from <code class="docutils literal notranslate"><span class="pre">RequestLog</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#customizing-timestamp-format">Customizing timestamp format</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#customizing-an-access-log-writer">Customizing an access log writer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#customizing-an-access-logger">Customizing an access logger</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="server-cors.html">Configuring CORS</a></li>
<li class="toctree-l2"><a class="reference internal" href="server-sse.html">Serving Server-Sent Events</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="client.html">Writing a client</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced.html">Advanced topics</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/line/armeria/releases">Release notes</a></li>
<li class="toctree-l1"><a class="reference external" href="apidocs/index.html#://">API documentation</a></li>
<li class="toctree-l1"><a class="reference external" href="xref/index.html#://">Source cross-reference</a></li>
<li class="toctree-l1"><a class="reference external" href="https://stackoverflow.com/questions/tagged/armeria">Questions and answers</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/line/armeria">Fork me on GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/line/armeria/blob/master/CONTRIBUTING.md">Contributing</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Armeria</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="server.html">Writing a server</a> &raquo;</li>
        
      <li>Writing an access log</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/line/armeria/blob/master/site/src/sphinx/server-access-log.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="writing-an-access-log">
<span id="server-access-log"></span><h1>Writing an access log<a class="headerlink" href="#writing-an-access-log" title="Permalink to this headline">¶</a></h1>
<div class="section" id="configuring-logging-framework">
<h2>Configuring logging framework<a class="headerlink" href="#configuring-logging-framework" title="Permalink to this headline">¶</a></h2>
<p>To write an access log, you need to configure a logging framework first. The following configurations are
simple examples of <code class="docutils literal notranslate"><span class="pre">logback.xml</span></code> and <code class="docutils literal notranslate"><span class="pre">log4j2.xml</span></code> respectively.</p>
<div class="section" id="logback">
<h3>logback<a class="headerlink" href="#logback" title="Permalink to this headline">¶</a></h3>
<div class="highlight-xml notranslate"><div class="highlight hljs"><pre class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;configuration&gt;
  &lt;appender name=&quot;CONSOLE&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt;
    &lt;encoder&gt;
      &lt;pattern&gt;%-4relative [%thread] %-5level %logger{35} - %msg%n&lt;/pattern&gt;
    &lt;/encoder&gt;
  &lt;/appender&gt;

  &lt;appender name=&quot;ACCESS&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;
    &lt;file&gt;access.log&lt;/file&gt;
    &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;&gt;
      &lt;!-- daily rollover --&gt;
      &lt;fileNamePattern&gt;access.%d{yyyy-MM-dd}-%i.log&lt;/fileNamePattern&gt;
      &lt;!-- each file should be at most 1GB, keep 30 days worth of history, but at most 30GB --&gt;
      &lt;maxFileSize&gt;1GB&lt;/maxFileSize&gt;
      &lt;maxHistory&gt;30&lt;/maxHistory&gt;
      &lt;totalSizeCap&gt;30GB&lt;/totalSizeCap&gt;
    &lt;/rollingPolicy&gt;
    &lt;encoder&gt;
      &lt;pattern&gt;%msg%n&lt;/pattern&gt;
    &lt;/encoder&gt;
  &lt;/appender&gt;

  &lt;logger name=&quot;com.linecorp.armeria.logging.access&quot; level=&quot;INFO&quot; additivity=&quot;false&quot;&gt;
    &lt;appender-ref ref=&quot;ACCESS&quot;/&gt;
  &lt;/logger&gt;

  &lt;root level=&quot;DEBUG&quot;&gt;
    &lt;appender-ref ref=&quot;CONSOLE&quot;/&gt;
  &lt;/root&gt;
&lt;/configuration&gt;</pre></div>
</div>
</div>
<div class="section" id="log4j2">
<h3>log4j2<a class="headerlink" href="#log4j2" title="Permalink to this headline">¶</a></h3>
<div class="highlight-xml notranslate"><div class="highlight hljs"><pre class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Configuration status=&quot;WARN&quot;&gt;
  &lt;Appenders&gt;
    &lt;Console name=&quot;CONSOLE&quot; target=&quot;SYSTEM_OUT&quot;&gt;
      &lt;PatternLayout pattern=&quot;%d{HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n&quot;/&gt;
    &lt;/Console&gt;
    &lt;RollingFile name=&quot;ACCESS&quot; fileName=&quot;access.log&quot;
                 filePattern=&quot;access.%d{MM-dd-yyyy}-%i.log.gz&quot;&gt;
      &lt;PatternLayout&gt;
        &lt;Pattern&gt;%m%n&lt;/Pattern&gt;
      &lt;/PatternLayout&gt;

      &lt;Policies&gt;
        &lt;!-- daily rollover --&gt;
        &lt;TimeBasedTriggeringPolicy/&gt;
        &lt;!-- each file should be at most 1GB --&gt;
        &lt;SizeBasedTriggeringPolicy size=&quot;1GB&quot;/&gt;
      &lt;/Policies&gt;
      &lt;!-- keep 30 archives --&gt;
      &lt;DefaultRolloverStrategy max=&quot;30&quot;/&gt;
    &lt;/RollingFile&gt;
  &lt;/Appenders&gt;

  &lt;Loggers&gt;
    &lt;Logger name=&quot;com.linecorp.armeria.logging.access&quot; level=&quot;INFO&quot; additivity=&quot;false&quot;&gt;
      &lt;AppenderRef ref=&quot;ACCESS&quot;/&gt;
    &lt;/Logger&gt;
    &lt;Root level=&quot;DEBUG&quot;&gt;
      &lt;AppenderRef ref=&quot;CONSOLE&quot;/&gt;
    &lt;/Root&gt;
  &lt;/Loggers&gt;
&lt;/Configuration&gt;</pre></div>
</div>
</div>
</div>
<div class="section" id="customizing-a-log-format">
<span id="customizing-log-format"></span><h2>Customizing a log format<a class="headerlink" href="#customizing-a-log-format" title="Permalink to this headline">¶</a></h2>
<p>Access logging is disabled by default. If you want to enable it, you need to specify an <code class="code api-reference docutils literal javadoc"><a class="code api-reference reference external javadoc" href="apidocs/com/linecorp/armeria/server/logging/AccessLogWriter.html">AccessLogWriter</a></code>.
You may use one of the pre-defined log formats.</p>
<div class="highlight-java notranslate"><div class="highlight hljs"><pre class="java">import com.linecorp.armeria.server.ServerBuilder;
import com.linecorp.armeria.server.logging.AccessLogWriter;

ServerBuilder sb = Server.builder();
// Use NCSA common log format.
sb.accessLogWriter(AccessLogWriter.common(), true);
// Use NCSA combined log format.
sb.accessLogWriter(AccessLogWriter.combined(), true);
// Use your own log format.
sb.accessLogFormat(&quot;...log format...&quot;);
...</pre></div>
</div>
<p>You can have different <code class="code api-reference docutils literal javadoc"><a class="code api-reference reference external javadoc" href="apidocs/com/linecorp/armeria/server/logging/AccessLogWriter.html">AccessLogWriter</a><span class="code api-reference plural-suffix">s</span></code> for <code class="code api-reference docutils literal javadoc"><a class="code api-reference reference external javadoc" href="apidocs/com/linecorp/armeria/server/VirtualHost.html">VirtualHost</a><span class="code api-reference plural-suffix">s</span></code> and <code class="code api-reference docutils literal javadoc"><a class="code api-reference reference external javadoc" href="apidocs/com/linecorp/armeria/server/Service.html">Service</a><span class="code api-reference plural-suffix">s</span></code>.</p>
<div class="highlight-java notranslate"><div class="highlight hljs"><pre class="java">ServerBuilder sb = Server.builder();
AccessLogWriter fallbackLogWriter = ...
sb.accessLogWriter(fallbackLogWriter);

sb.virtualHost(&quot;foo.com&quot;)
  .accessLogWriter(AccessLogWriter.combined(), true)
  .service((ctx, req) -&gt; HttpResponse.of(OK)); // This service will log using the combined format.
  ...

sb.route()
  .get(&quot;/commonAccessLog&quot;)
  .accessLogWriter(AccessLogWriter.common(), true)
  .build((ctx, req) -&gt; HttpResponse.of(OK)); // This service will log using the common format.

// This service will log using the fallbackLogWriter.
sb.service(&quot;/fallbackLogWriter&quot;, (ctx, req) -&gt; HttpResponse.of(OK));</pre></div>
</div>
<p>Pre-defined log formats are as follows.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 15%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Format</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">common</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">%h</span> <span class="pre">%l</span> <span class="pre">%u</span> <span class="pre">%t</span> <span class="pre">&quot;%r&quot;</span> <span class="pre">%s</span> <span class="pre">%b</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">combined</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">%h</span> <span class="pre">%l</span> <span class="pre">%u</span> <span class="pre">%t</span> <span class="pre">&quot;%r&quot;</span> <span class="pre">%s</span> <span class="pre">%b</span> <span class="pre">&quot;%{Referer}i&quot;</span> <span class="pre">&quot;%{User-Agent}i&quot;</span> <span class="pre">&quot;%{Cookie}i&quot;</span></code></p></td>
</tr>
</tbody>
</table>
<p>Tokens for the log format are listed in the following table.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 28%" />
<col style="width: 19%" />
<col style="width: 53%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Tokens</p></th>
<th class="head"><p>Condition support</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">%A</span></code></p></td>
<td><p>No</p></td>
<td><p>the local IP address</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">%a</span></code></p></td>
<td><p>No</p></td>
<td><p>the IP address of the client who initiated a
request. Use <code class="docutils literal notranslate"><span class="pre">%{c}a</span></code> format string to get the
remote IP address where the channel is connected
to, which may yield a different value when there
is an intermediary proxy server.
This value relies on the <code class="docutils literal notranslate"><span class="pre">clientAddress()</span></code> and
<code class="docutils literal notranslate"><span class="pre">remoteAddress()</span></code> methods of
<code class="code api-reference docutils literal javadoc"><a class="code api-reference reference external javadoc" href="apidocs/com/linecorp/armeria/server/ServiceRequestContext.html">ServiceRequestContext</a></code>, please refer to
<a class="reference internal" href="server-basics.html#client-address"><span class="std std-ref">Getting an IP address of a client who initiated a request</span></a> about how to configure the
<code class="code api-reference docutils literal javadoc"><a class="code api-reference reference external javadoc" href="apidocs/com/linecorp/armeria/server/ServerBuilder.html">ServerBuilder</a></code> to get the client address you
interest.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">%h</span></code></p></td>
<td><p>No</p></td>
<td><p>the remote hostname or IP address if DNS
hostname lookup is not available</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">%I</span></code></p></td>
<td><p>No</p></td>
<td><p>the request ID. Use <code class="docutils literal notranslate"><span class="pre">%{short}I</span></code> format string to
get the short form.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">%l</span></code></p></td>
<td><p>No</p></td>
<td><p>the remote logname of the user
(not supported yet, always write <code class="docutils literal notranslate"><span class="pre">-</span></code>)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">%u</span></code></p></td>
<td><p>No</p></td>
<td><p>the name of the authenticated remote user
(not supported yet, always write <code class="docutils literal notranslate"><span class="pre">-</span></code>)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">%t</span></code></p></td>
<td><p>No</p></td>
<td><p>the date, time and time zone that the request
was received, by default in <code class="docutils literal notranslate"><span class="pre">strftime</span></code> format
%d/%b/%Y:%H:%M:%S %z.
(for example, <code class="docutils literal notranslate"><span class="pre">10/Oct/2000:13:55:36</span> <span class="pre">-0700</span></code>)
Refer to <a class="reference internal" href="#timestamp-format"><span class="std std-ref">Customizing timestamp format</span></a> for more
information.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">%r</span></code></p></td>
<td><p>Yes</p></td>
<td><p>the request line from the client
(for example, <code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/path</span> <span class="pre">h2</span></code>)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">%s</span></code></p></td>
<td><p>No</p></td>
<td><p>the HTTP status code returned to the client</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">%b</span></code></p></td>
<td><p>Yes</p></td>
<td><p>the size of the object returned to the client,
measured in bytes</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">%{HEADER_NAME}i</span></code></p></td>
<td><p>Yes</p></td>
<td><p>the value of the specified HTTP request header
name</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">%{HEADER_NAME}o</span></code></p></td>
<td><p>Yes</p></td>
<td><p>the value of the specified HTTP response header
name</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">%{ATTRIBUTE_NAME}j</span></code></p></td>
<td><p>Yes</p></td>
<td><p>the value of the specified attribute name</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">%{REQUEST_LOG_NAME}L</span></code></p></td>
<td><p>Yes</p></td>
<td><p>the value of the specified variable of the
<code class="code api-reference docutils literal javadoc"><a class="code api-reference reference external javadoc" href="apidocs/com/linecorp/armeria/common/logging/RequestLog.html">RequestLog</a></code>. Refer to <a class="reference internal" href="#request-log"><span class="std std-ref">Retrieving values from RequestLog</span></a>
for more information.</p></td>
</tr>
</tbody>
</table>
<p>Some tokens can have a condition of the response status code and the log message can be omitted with
the condition.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 52%" />
<col style="width: 48%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Example of a condition</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">%200b</span></code></p></td>
<td><p>Write the size of the object returned to the
client only if the response code is <code class="docutils literal notranslate"><span class="pre">200</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">%200,304{User-Agent}i</span></code></p></td>
<td><p>Write <code class="docutils literal notranslate"><span class="pre">User-Agent</span></code> header value only if the
response code is <code class="docutils literal notranslate"><span class="pre">200</span></code> or <code class="docutils literal notranslate"><span class="pre">304</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">%!200,304{com.example.armeria.Attribute#KEY}j</span></code></p></td>
<td><p>Write the value of the specified attribute
only if the response code is neither <code class="docutils literal notranslate"><span class="pre">200</span></code>
nor <code class="docutils literal notranslate"><span class="pre">304</span></code>.</p></td>
</tr>
</tbody>
</table>
<div class="section" id="retrieving-values-from-requestlog">
<span id="request-log"></span><h3>Retrieving values from <code class="docutils literal notranslate"><span class="pre">RequestLog</span></code><a class="headerlink" href="#retrieving-values-from-requestlog" title="Permalink to this headline">¶</a></h3>
<p><code class="code api-reference docutils literal javadoc"><a class="code api-reference reference external javadoc" href="apidocs/com/linecorp/armeria/common/logging/RequestLog.html">RequestLog</a></code> holds information about the request, so a user may want to write these values to his or
her access log file. To write them in a simple way, <code class="docutils literal notranslate"><span class="pre">%{variable}L</span></code> token is provided with the following
supported variable:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 31%" />
<col style="width: 69%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">method</span></code></p></td>
<td><p>the HTTP method value of the request</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">path</span></code></p></td>
<td><p>the absolute path part of the HTTP request URI</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">query</span></code></p></td>
<td><p>the query part of the HTTP request URI</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">requestStartTimeMillis</span></code></p></td>
<td><p>the time when the processing of the request started,
in milliseconds since the epoch</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">requestDurationMillis</span></code></p></td>
<td><p>the duration that was taken to consume or produce the request
completely, in milliseconds</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">requestDurationNanos</span></code></p></td>
<td><p>the duration that was taken to consume or produce the request
completely, in nanoseconds</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">requestLength</span></code></p></td>
<td><p>the length of the request content</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">requestCause</span></code></p></td>
<td><p>the cause of request processing failure. The class name of the
cause and the detail message of it will be contained if exists.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">requestContentPreview</span></code></p></td>
<td><p>the preview of the request content</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">responseStartTimeMillis</span></code></p></td>
<td><p>the time when the processing of the response started,
in milliseconds since the epoch</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">responseDurationMillis</span></code></p></td>
<td><p>the duration that was taken to consume or produce the response
completely, in milliseconds</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">responseDurationNanos</span></code></p></td>
<td><p>the duration that was taken to consume or produce the response
completely, in nanoseconds</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">responseLength</span></code></p></td>
<td><p>the length of the response content</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">responseCause</span></code></p></td>
<td><p>the cause of response processing failure. The class name of the
cause and the detail message of it will be contained if exists.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">responseContentPreview</span></code></p></td>
<td><p>the preview of the response content</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">totalDurationMillis</span></code></p></td>
<td><p>the amount of time taken since the request processing started and
until the response processing ended, in milliseconds</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">totalDurationNanos</span></code></p></td>
<td><p>the amount of time taken since the request processing started and
until the response processing ended, in nanoseconds</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">sessionProtocol</span></code></p></td>
<td><p>the session protocol of the request.
e.g. <code class="docutils literal notranslate"><span class="pre">h1</span></code>, <code class="docutils literal notranslate"><span class="pre">h2</span></code>, <code class="docutils literal notranslate"><span class="pre">h1c</span></code> or <code class="docutils literal notranslate"><span class="pre">h2c</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">serializationFormat</span></code></p></td>
<td><p>the serialization format of the request.
e.g. <code class="docutils literal notranslate"><span class="pre">tbinary</span></code>, <code class="docutils literal notranslate"><span class="pre">ttext</span></code>, <code class="docutils literal notranslate"><span class="pre">tcompact</span></code>, <code class="docutils literal notranslate"><span class="pre">tjson</span></code> or <code class="docutils literal notranslate"><span class="pre">none</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">scheme</span></code></p></td>
<td><p>the scheme value printed as <code class="docutils literal notranslate"><span class="pre">serializationFormat+sessionProtocol</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">host</span></code></p></td>
<td><p>the host name of the request</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">status</span></code></p></td>
<td><p>the status code and its reason phrase of the response.
e.g. <code class="docutils literal notranslate"><span class="pre">200</span> <span class="pre">OK</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">statusCode</span></code></p></td>
<td><p>the status code of the response. e.g. <code class="docutils literal notranslate"><span class="pre">200</span></code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="customizing-timestamp-format">
<span id="timestamp-format"></span><h3>Customizing timestamp format<a class="headerlink" href="#customizing-timestamp-format" title="Permalink to this headline">¶</a></h3>
<p>You can specify a new date/time format for the <code class="docutils literal notranslate"><span class="pre">%t</span></code> token with <a class="reference external" href="https://docs.oracle.com/javase/10/docs/api/java/time/format/DateTimeFormatter.html">DateTimeFormatter</a>. You can use one of the
following formatters which is provided by JDK as a variable of the <code class="docutils literal notranslate"><span class="pre">%t</span></code> token, e.g. <code class="docutils literal notranslate"><span class="pre">%{BASIC_ISO_DATE}t</span></code>.
If you want to use your own pattern, you can specify it as the variable, e.g. <code class="docutils literal notranslate"><span class="pre">%{yyyy</span> <span class="pre">MM</span> <span class="pre">dd}t</span></code>.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 24%" />
<col style="width: 33%" />
<col style="width: 43%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Formatter</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Example</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">BASIC_ISO_DATE</span></code></p></td>
<td><p>Basic ISO date</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">20111203</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ISO_LOCAL_DATE</span></code></p></td>
<td><p>ISO Local Date</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">2011-12-03</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ISO_OFFSET_DATE</span></code></p></td>
<td><p>ISO Date with offset</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">2011-12-03+01:00</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ISO_DATE</span></code></p></td>
<td><p>ISO Date with or without offset</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">2011-12-03+01:00</span></code>; <code class="docutils literal notranslate"><span class="pre">2011-12-03</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ISO_LOCAL_TIME</span></code></p></td>
<td><p>Time without offset</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">10:15:30</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ISO_OFFSET_TIME</span></code></p></td>
<td><p>Time with offset</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">10:15:30+01:00</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ISO_TIME</span></code></p></td>
<td><p>Time with or without offset</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">10:15:30+01:00</span></code>; <code class="docutils literal notranslate"><span class="pre">10:15:30</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ISO_LOCAL_DATE_TIME</span></code></p></td>
<td><p>ISO Local Date and Time</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">2011-12-03T10:15:30</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ISO_OFFSET_DATE_TIME</span></code></p></td>
<td><p>Date Time with Offset</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">2011-12-03T10:15:30+01:00</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ISO_ZONED_DATE_TIME</span></code></p></td>
<td><p>Zoned Date Time</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">2011-12-03T10:15:30+01:00[Europe/Paris]</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ISO_DATE_TIME</span></code></p></td>
<td><p>Date and time with ZoneId</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">2011-12-03T10:15:30+01:00[Europe/Paris]</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ISO_ORDINAL_DATE</span></code></p></td>
<td><p>Year and day of year</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">2012-337</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ISO_WEEK_DATE</span></code></p></td>
<td><p>Year and Week</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">2012-W48-6</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ISO_INSTANT</span></code></p></td>
<td><p>Date and Time of an Instant</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">2011-12-03T10:15:30Z</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">RFC_1123_DATE_TIME</span></code></p></td>
<td><p>RFC 1123 / RFC 822</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Tue,</span> <span class="pre">3</span> <span class="pre">Jun</span> <span class="pre">2008</span> <span class="pre">11:05:30</span> <span class="pre">GMT</span></code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="customizing-an-access-log-writer">
<h2>Customizing an access log writer<a class="headerlink" href="#customizing-an-access-log-writer" title="Permalink to this headline">¶</a></h2>
<p>You can specify your own log writer which implements a <code class="docutils literal notranslate"><span class="pre">Consumer</span></code> of <code class="code api-reference docutils literal javadoc"><a class="code api-reference reference external javadoc" href="apidocs/com/linecorp/armeria/common/logging/RequestLog.html">RequestLog</a></code>.</p>
<div class="highlight-java notranslate"><div class="highlight hljs"><pre class="java">ServerBuilder sb = Server.builder();
sb.accessLogWriter(requestLog -&gt; {
    // Write your access log with the given RequestLog instance.
    ....
}, true);</pre></div>
</div>
</div>
<div class="section" id="customizing-an-access-logger">
<h2>Customizing an access logger<a class="headerlink" href="#customizing-an-access-logger" title="Permalink to this headline">¶</a></h2>
<p>Armeria uses an SLF4J logger whose name is based on a reversed domain name of each virtual host by
default, e.g.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">com.linecorp.armeria.logging.access.com.example</span></code> for <code class="docutils literal notranslate"><span class="pre">*.example.com</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">com.linecorp.armeria.logging.access.com.linecorp</span></code> for <code class="docutils literal notranslate"><span class="pre">*.linecorp.com</span></code></p></li>
</ul>
<p>Alternatively, you can specify your own mapper or logger for a <code class="code api-reference docutils literal javadoc"><a class="code api-reference reference external javadoc" href="apidocs/com/linecorp/armeria/server/VirtualHost.html">VirtualHost</a></code>, e.g.</p>
<div class="highlight-java notranslate"><div class="highlight hljs"><pre class="java">ServerBuilder sb = Server.builder();

// Using the specific logger name.
sb.accessLogger(&quot;com.example.my.access.logs&quot;);
....

// Using your own logger.
Logger logger = LoggerFactory.getLogger(&quot;com.example2.my.access.logs&quot;);
sb.accessLogger(Logger);
....

// Using the mapper which sets an access logger with the given VirtualHost instance.
sb.accessLogger(virtualHost -&gt; {
    // Return the logger.
    // Do not return null. Otherwise, it will raise an IllegalStateException.
    return LoggerFactory.getLogger(&quot;com.example.my.access.logs.&quot; + virtualHost.defaultHostname());
});
....</pre></div>
</div>
<p>You can also specify your own logger for the specific <code class="code api-reference docutils literal javadoc"><a class="code api-reference reference external javadoc" href="apidocs/com/linecorp/armeria/server/VirtualHost.html">VirtualHost</a></code>. In this case, the mapper or logger
you set for a specific <code class="code api-reference docutils literal javadoc"><a class="code api-reference reference external javadoc" href="apidocs/com/linecorp/armeria/server/VirtualHost.html">VirtualHost</a></code> will override the access logger set via
<code class="docutils literal notranslate"><span class="pre">ServerBuilder.accessLogger()</span></code>.</p>
<div class="highlight-java notranslate"><div class="highlight hljs"><pre class="java">// Using the specific logger name.
sb.virtualHost(&quot;*.example.com&quot;)
  .accessLogger(&quot;com.example.my.access.logs&quot;)
  .and()
....

// Using your own logger.
Logger logger = LoggerFactory.getLogger(&quot;com.example2.my.access.logs&quot;);
sb.virtualHost(&quot;*.example2.com&quot;)
  .accessLogger(Logger)
  .and()
....

// Using the mapper which sets an access logger with the given VirtualHost instance.
sb.virtualHost(&quot;*.example3.com&quot;)
  .accessLogger(virtualHost -&gt; {
    // Return the logger.
    // Do not return null. Otherwise, it will raise an IllegalStateException.
    return LoggerFactory.getLogger(&quot;com.example.my.access.logs.&quot; + virtualHost.defaultHostname());
  })
....</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="server-cors.html" class="btn btn-neutral float-right" title="Configuring CORS" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="server-servlet.html" class="btn btn-neutral float-left" title="Embedding a servlet container" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015-2020, LINE Corporation

    </p>
  </div>
<div id="privacy_policy" role="contentinfo">
  <p>
    <a id="privacy_policy_text" href="https://terms.line.me/line_rules?lang=en">Privacy policy</a>
  </p>
</div>
<script>
  var contentInfoPara = document.querySelector("div[role=contentinfo] > p");
  if (contentInfoPara && contentInfoPara.id !== 'privacy_policy') {
    var privacyPolicyDiv = document.getElementById('privacy_policy');
    var privacyPolicyText = document.getElementById('privacy_policy_text');
    contentInfoPara.append(' | ');
    contentInfoPara.append(privacyPolicyText);
    privacyPolicyDiv.parentNode.removeChild(privacyPolicyDiv);
  }
</script>


</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-145425527-1', 'auto');
    ga('send', 'pageview');
    </script>

    
  
  <a href="https://github.com/line/armeria" class="github-corner" aria-label="View source on GitHub">
    <svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true">
      <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z" fill="#3a3a3a"></path>
      <path class="octo-arm" d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="#ffffff" style="transform-origin: 130px 106px;"></path>
      <path class="octo-body" d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="#ffffff"></path>
    </svg>
  </a>
  <script type="text/javascript" src="_static/add_badges.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/gradle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/protobuf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/thrift.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/yaml.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.7.0/highlightjs-line-numbers.min.js"></script>
  <script>
    document.querySelectorAll('div.hljs > pre').forEach(function(block) {
      hljs.highlightBlock(block);
      hljs.lineNumbersBlock(block);
    });
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.1/cookieconsent.min.js"></script>
  <script>
    window.cookieconsent.initialise({
      "palette": {
        "popup": {
          "background": "rgba(58,58,58,0.75)",
          "text": "#F8F8F8"
        },
        "button": {
          "background": "transparent",
          "text": "#F8F8F8",
          "border": "#F8F8F8"
        }
      },
      "content": {
        "message": "This website uses anonymous cookies to ensure we provide you the best experience. ",
        "link": "Opt out!",
        "href": "https://tools.google.com/dlpage/gaoptout/",
        "target": '_blank'
      }
    });
  </script>
   


</body>
</html>